<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Calorie Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      /* Default Theme (Papas) */
      --bg: #0b1020;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.65);
      
      --primary: #3b82f6; /* Blue for Papas */
      --primary-glow: rgba(59,130,246,0.4);
      
      --danger: #ef4444;

      --shadow: 0 4px 20px rgba(0,0,0,.25);
      --radius: 16px;
    }

    /* Dedes Theme Override */
    body.theme-dedes {
      --primary: #ec4899; /* Pink for Dedes */
      --primary-glow: rgba(236, 72, 153, 0.4);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    html { min-height: 100%; }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      /* Fixed background */
      background-color: var(--bg);
      background-image: 
        radial-gradient(at 0% 0%, rgba(59,130,246,.15), transparent 50%),
        radial-gradient(at 100% 100%, rgba(236, 72, 153,.15), transparent 50%);
      background-attachment: fixed;
      padding-bottom: 40px; /* Space for toast */
    }

    .wrap {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px 16px;
    }

    /* --- HEADER --- */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo {
      width: 42px; height: 42px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary), #8b5cf6);
      box-shadow: 0 4px 12px var(--primary-glow);
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 20px; color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .title-text h1 { margin: 0; font-size: 18px; letter-spacing: -0.5px; }
    .title-text p { margin: 0; font-size: 12px; color: var(--muted); }

    /* User Switcher Pill */
    .user-switch {
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      padding: 3px;
      display: flex;
      border: 1px solid var(--stroke);
    }
    .user-btn {
      padding: 6px 14px;
      border-radius: 16px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 13px; font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .user-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 8px var(--primary-glow);
    }

    /* --- LAYOUT GRID --- */
    .grid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 16px;
      align-items: start;
    }

    /* --- CARDS --- */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card-header {
      padding: 16px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .card-header h2 { margin: 0; font-size: 16px; font-weight: 600; }
    
    .card-body { padding: 16px; }
    
    /* Input Styling */
    label { display: block; font-size: 12px; font-weight: 600; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.2);
      color: white;
      font-size: 16px; /* Prevents iOS zoom on focus */
      outline: none;
      transition: border-color 0.2s;
    }
    input:focus, textarea:focus { border-color: var(--primary); }

    .row { display: flex; gap: 12px; }
    .col { flex: 1; }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 600; font-size: 14px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      transition: transform 0.1s, opacity 0.2s;
    }
    .btn:active { transform: scale(0.98); }
    .btn.primary { background: var(--primary); color: white; box-shadow: 0 4px 12px var(--primary-glow); }
    .btn.ghost { background: transparent; color: var(--muted); border: 1px solid var(--stroke); }
    .btn.danger { background: rgba(239,68,68,0.15); color: #fca5a5; border: 1px solid rgba(239,68,68,0.3); }

    /* Quick Add Buttons */
    .segmented {
      display: flex; gap: 8px; margin-bottom: 0;
      background: rgba(0,0,0,0.2); padding: 4px; border-radius: 12px;
    }
    .segmented button {
      flex: 1; padding: 8px 0; border: none; background: transparent;
      color: var(--muted); font-size: 12px; font-weight: 700; border-radius: 8px; cursor: pointer;
    }
    .segmented button.active { background: var(--stroke); color: white; }

    /* History Table */
    .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    table { width: 100%; border-collapse: collapse; min-width: 100%; }
    th { text-align: left; font-size: 11px; text-transform: uppercase; color: var(--muted); padding: 12px 16px; border-bottom: 1px solid var(--stroke); white-space: nowrap; }
    td { padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
    .btn-xs { padding: 4px 10px; font-size: 11px; border-radius: 6px; width: auto; display: inline-block; }

    /* Stats Chips */
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
    .stat-card {
      background: rgba(255,255,255,0.03); border: 1px solid var(--stroke);
      border-radius: 14px; padding: 12px; text-align: center;
    }
    .stat-label { font-size: 11px; color: var(--muted); text-transform: uppercase; font-weight: 700; }
    .stat-val { font-size: 24px; font-weight: 800; margin-top: 4px; color: white; }

    /* Toast Notification */
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translate(-50%, 20px);
      background: #1e1e1e; border: 1px solid var(--stroke); color: white;
      padding: 12px 24px; border-radius: 50px; font-weight: 600; font-size: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5); opacity: 0; pointer-events: none;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000;
      white-space: nowrap;
    }
    .toast.show { opacity: 1; transform: translate(-50%, 0); }

    /* --- MOBILE RESPONSIVE TWEAKS --- */
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      
      .topbar { flex-direction: column; gap: 16px; align-items: stretch; }
      .brand { justify-content: center; }
      .user-switch { justify-content: center; }
      .user-btn { flex: 1; text-align: center; }

      /* Make inputs stack vertically on mobile for easier tapping */
      .row { flex-direction: column; gap: 16px; }
      
      /* Make Quick Add buttons wrap if too small */
      .segmented { overflow-x: auto; }
      .segmented button { min-width: 60px; }

      /* Adjust font sizes */
      .stat-val { font-size: 20px; }
    }
  </style>
</head>

<body id="body">

<div class="wrap">
  
  <div class="topbar">
    <div class="brand">
      <div class="logo" id="appLogo">P</div>
      <div class="title-text">
        <h1>Calorie Tracker</h1>
        <p id="userSubtext">Logged in as Papas</p>
      </div>
    </div>
    <div class="user-switch">
      <button class="user-btn active" id="btnPapas" onclick="switchUser('Papas')">Papas</button>
      <button class="user-btn" id="btnDedes" onclick="switchUser('Dedes')">Dedes</button>
    </div>
  </div>

  <div class="grid">
    
    <div style="display:flex; flex-direction:column; gap:16px;">
      
      <div class="card">
        <div class="card-header" style="flex-direction: column; align-items: stretch; gap:10px;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Add Entry</h2>
            <button class="btn ghost btn-xs" onclick="setToday()" style="width:auto;">Set Today</button>
          </div>
          <div class="segmented">
            <button class="active" onclick="setQuick(0, this)">Manual</button>
            <button onclick="setQuick(200, this)">+200</button>
            <button onclick="setQuick(400, this)">+400</button>
            <button onclick="setQuick(600, this)">+600</button>
          </div>
        </div>
        
        <div class="card-body">
          <div class="row">
            <div class="col">
              <label>Date</label>
              <input type="date" id="dateInput">
            </div>
            <div class="col">
              <label>Calories</label>
              <input type="number" id="caloriesInput" placeholder="0" inputmode="numeric">
            </div>
          </div>
          <div style="margin-top:16px;">
            <label>Description</label>
            <input type="text" id="mealNote" placeholder="e.g. Chicken Rice">
          </div>
          <div style="margin-top:20px;">
            <button class="btn primary" onclick="addEntry()">Add Entry</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>Trend</h2>
        </div>
        <div class="card-body">
          <div style="height: 200px; width: 100%;">
            <canvas id="calorieChart"></canvas>
          </div>
        </div>
      </div>

    </div>

    <div style="display:flex; flex-direction:column; gap:16px;">
      
      <div class="card">
        <div class="card-body">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Today</div>
              <div class="stat-val" id="statToday">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">7-Day Avg</div>
              <div class="stat-val" id="statAvg">0</div>
            </div>
          </div>
          
          <label>Daily Goal</label>
          <div style="display:flex; gap:8px;">
            <input type="number" id="targetInput" placeholder="2000" inputmode="numeric">
            <button class="btn ghost" style="width: auto;" onclick="saveTarget()">Set</button>
          </div>
          <div style="margin-top:8px; font-size:12px; color:var(--muted);" id="targetFeedback"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>History</h2>
          <button class="btn ghost btn-xs" onclick="exportData()">Export</button>
        </div>
        <div class="table-container">
          <table id="historyTable">
            <thead><tr><th>Date</th><th>Kcal</th><th>Item</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
          <div id="emptyState" style="padding: 24px; text-align: center; color: var(--muted); font-size: 13px;">
            No records found.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <button class="btn danger" onclick="clearUserdata()">Clear Data for <span id="deleteUserName">User</span></button>
        </div>
      </div>

    </div>
  </div>

</div>

<div class="toast" id="toast">Saved successfully</div>

<script>
    // --- APP STATE ---
    let currentUser = localStorage.getItem('activeUser') || 'Papas';
    let entries = [];
    let chartInstance = null;

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        switchUser(currentUser, false);
        setToday();
    });

    // --- CORE LOGIC ---
    function switchUser(user, reload = true) {
        currentUser = user;
        localStorage.setItem('activeUser', user);

        // Update UI Visuals
        document.getElementById('btnPapas').className = user === 'Papas' ? 'user-btn active' : 'user-btn';
        document.getElementById('btnDedes').className = user === 'Dedes' ? 'user-btn active' : 'user-btn';
        document.getElementById('appLogo').textContent = user.charAt(0);
        document.getElementById('userSubtext').textContent = `Logged in as ${user}`;
        document.getElementById('deleteUserName').textContent = user;

        const body = document.getElementById('body');
        if(user === 'Dedes') body.classList.add('theme-dedes');
        else body.classList.remove('theme-dedes');

        // Reload Data
        loadData();
    }

    function getKey(key) { return `${currentUser}_${key}`; }

    function loadData() {
        entries = JSON.parse(localStorage.getItem(getKey('entries'))) || [];
        const target = localStorage.getItem(getKey('target')) || '';
        document.getElementById('targetInput').value = target;
        
        refreshUI();
    }

    function refreshUI() {
        renderTable();
        renderChart();
        renderStats();
    }

    // --- ACTIONS ---
    function addEntry() {
        const date = document.getElementById('dateInput').value;
        const cals = document.getElementById('caloriesInput').value;
        const note = document.getElementById('mealNote').value;

        if(!date || !cals) {
            showToast("Please enter date and calories");
            return;
        }

        entries.push({
            id: Date.now(),
            date,
            calories: parseInt(cals),
            note
        });

        save();
        
        // Reset Inputs
        document.getElementById('caloriesInput').value = '';
        document.getElementById('mealNote').value = '';
        // Reset quick buttons
        document.querySelectorAll('.segmented button').forEach(b => b.classList.remove('active'));
        document.querySelector('.segmented button').classList.add('active'); // Set first one active
        
        showToast("Entry added!");
    }

    function deleteEntry(id) {
        if(confirm("Delete this entry?")) {
            entries = entries.filter(e => e.id !== id);
            save();
            showToast("Deleted");
        }
    }

    function save() {
        localStorage.setItem(getKey('entries'), JSON.stringify(entries));
        refreshUI();
    }

    function saveTarget() {
        const t = document.getElementById('targetInput').value;
        localStorage.setItem(getKey('target'), t);
        renderStats();
        showToast("Goal saved");
    }

    function clearUserdata() {
        if(confirm(`Delete ALL history for ${currentUser}?`)) {
            localStorage.removeItem(getKey('entries'));
            localStorage.removeItem(getKey('target'));
            entries = [];
            refreshUI();
            showToast("Data cleared");
        }
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(entries));
        const a = document.createElement('a');
        a.href = dataStr;
        a.download = `${currentUser}_calories_backup.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
    }

    // --- HELPER FUNCTIONS ---
    function setToday() {
        document.getElementById('dateInput').valueAsDate = new Date();
    }

    function setQuick(amt, btn) {
        document.querySelectorAll('.segmented button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        if(amt > 0) {
            const curr = parseInt(document.getElementById('caloriesInput').value) || 0;
            document.getElementById('caloriesInput').value = curr + amt;
        }
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    // --- RENDERERS ---
    function renderTable() {
        const tbody = document.querySelector('#historyTable tbody');
        const empty = document.getElementById('emptyState');
        tbody.innerHTML = '';

        const sorted = [...entries].sort((a,b) => new Date(b.date) - new Date(a.date));

        if(sorted.length === 0) {
            empty.style.display = 'block';
            return;
        }
        empty.style.display = 'none';

        sorted.forEach(e => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="color:var(--muted); font-size:12px;">${e.date.slice(5)}</td>
                <td style="font-weight:700;">${e.calories}</td>
                <td style="font-size:13px; max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                    ${e.note || '-'}
                </td>
                <td style="text-align:right;">
                    <button class="btn danger btn-xs" onclick="deleteEntry(${e.id})">Ã—</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function renderStats() {
        const todayStr = new Date().toISOString().split('T')[0];
        const todaySum = entries.filter(e => e.date === todayStr).reduce((a,b) => a + b.calories, 0);
        
        // 7 Day Avg
        const uniqueDays = [...new Set(entries.map(e => e.date))];
        const total = entries.reduce((a,b) => a + b.calories, 0);
        const avg = uniqueDays.length ? Math.round(total / uniqueDays.length) : 0;

        document.getElementById('statToday').innerText = todaySum;
        document.getElementById('statAvg').innerText = avg;

        // Feedback
        const target = parseInt(document.getElementById('targetInput').value) || 0;
        const fb = document.getElementById('targetFeedback');
        if(target > 0) {
            const diff = target - todaySum;
            fb.innerHTML = diff >= 0 
                ? `${diff} kcal remaining` 
                : `<span style="color:#fca5a5">Over by ${Math.abs(diff)} kcal</span>`;
        } else {
            fb.innerText = "Set a goal above.";
        }
    }

    function renderChart() {
        const ctx = document.getElementById('calorieChart').getContext('2d');
        
        // Data prep
        const grouped = {};
        entries.forEach(e => grouped[e.date] = (grouped[e.date] || 0) + e.calories);
        
        // Sort dates
        const labels = Object.keys(grouped).sort();
        const data = labels.map(d => grouped[d]);

        // Colors
        const isDedes = currentUser === 'Dedes';
        const color = isDedes ? '#ec4899' : '#3b82f6';
        const bg = isDedes ? 'rgba(236, 72, 153, 0.2)' : 'rgba(59,130,246,0.2)';

        if(chartInstance) chartInstance.destroy();

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels.map(l => l.slice(5)), // Show MM-DD only
                datasets: [{
                    data: data,
                    borderColor: color,
                    backgroundColor: bg,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: '#6b7280', font: {size: 10} }, grid: { display: false } },
                    y: { beginAtZero: true, ticks: { color: '#6b7280', font: {size: 10} }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
            }
        });
    }
</script>

</body>
</html>
